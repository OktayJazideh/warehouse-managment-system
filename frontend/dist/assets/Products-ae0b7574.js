import{r as v,b as j,s as B,h as D,o as u,c,d as e,t as p,w as q,e as I,f as n,v as d,x as V,F as $,j as F,k as w,a as R,y as T,z,n as E}from"./index-8650e4e1.js";const O={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},K={class:"relative top-20 mx-auto p-5 border max-w-2xl shadow-lg rounded-md bg-white"},W={class:"flex justify-between items-center mb-4"},G={class:"text-lg font-medium text-gray-900"},H={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Q=["value"],X={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Z={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},_={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ee={class:"flex justify-end space-x-3 pt-4"},te=["disabled"],se={__name:"ProductModal",props:{isOpen:Boolean,product:Object},emits:["close","saved"],setup(S,{emit:U}){const f=S,h=U,g=v(!1),m=v(""),b=v([]),t=j({code:"",name:"",description:"",categoryId:"",unit:"",unitPrice:0,costPrice:0,minStockLevel:0,maxStockLevel:null,weight:null,dimensions:"",barcode:"",sku:""}),P=()=>{t.code="",t.name="",t.description="",t.categoryId="",t.unit="",t.unitPrice=0,t.costPrice=0,t.minStockLevel=0,t.maxStockLevel=null,t.weight=null,t.dimensions="",t.barcode="",t.sku="",m.value=""},A=async()=>{try{const i=await w.get("/categories");b.value=i.data.data.categories}catch(i){console.error("Failed to load categories:",i)}},k=()=>{P(),h("close")},C=async()=>{var i,s,x,y,o,L,a;g.value=!0,m.value="";try{const l={code:t.code,name:t.name,description:t.description||void 0,categoryId:t.categoryId,unit:t.unit,unitPrice:parseFloat(t.unitPrice),costPrice:t.costPrice?parseFloat(t.costPrice):void 0,minStockLevel:t.minStockLevel?parseInt(t.minStockLevel):void 0,maxStockLevel:t.maxStockLevel?parseInt(t.maxStockLevel):void 0,weight:t.weight?parseFloat(t.weight):void 0,dimensions:t.dimensions||void 0,barcode:t.barcode||void 0,sku:t.sku||void 0};(i=f.product)!=null&&i.id?await w.put(`/products/${f.product.id}`,l):await w.post("/products",l),h("saved"),k()}catch(l){console.error("Form submission error:",l),m.value=((x=(s=l.response)==null?void 0:s.data)==null?void 0:x.message)||((a=(L=(o=(y=l.response)==null?void 0:y.data)==null?void 0:o.errors)==null?void 0:L[0])==null?void 0:a.msg)||"An error occurred while saving the product"}finally{g.value=!1}};return B(()=>f.product,i=>{i&&(t.code=i.code||"",t.name=i.name||"",t.description=i.description||"",t.categoryId=i.categoryId||"",t.unit=i.unit||"",t.unitPrice=i.unitPrice||0,t.costPrice=i.costPrice||0,t.minStockLevel=i.minStockLevel||0,t.maxStockLevel=i.maxStockLevel,t.weight=i.weight,t.dimensions=i.dimensions||"",t.barcode=i.barcode||"",t.sku=i.sku||"")},{immediate:!0}),D(()=>{A()}),(i,s)=>{var x,y;return S.isOpen?(u(),c("div",O,[e("div",K,[e("div",W,[e("h3",G,p((x=S.product)!=null&&x.id?"Edit Product":"Add New Product"),1),e("button",{onClick:k,class:"text-gray-400 hover:text-gray-600"},[...s[13]||(s[13]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:q(C,["prevent"]),class:"space-y-4"},[m.value?(u(),c("div",H,p(m.value),1)):I("",!0),e("div",J,[e("div",null,[s[14]||(s[14]=e("label",{class:"form-label"},"Product Code *",-1)),n(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>t.code=o),type:"text",class:"form-input",placeholder:"e.g. PRD001",required:""},null,512),[[d,t.code]])]),e("div",null,[s[15]||(s[15]=e("label",{class:"form-label"},"Product Name *",-1)),n(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>t.name=o),type:"text",class:"form-input",placeholder:"Product name",required:""},null,512),[[d,t.name]])])]),e("div",null,[s[17]||(s[17]=e("label",{class:"form-label"},"Category *",-1)),n(e("select",{"onUpdate:modelValue":s[2]||(s[2]=o=>t.categoryId=o),class:"form-input",required:""},[s[16]||(s[16]=e("option",{value:""},"Select Category",-1)),(u(!0),c($,null,F(b.value,o=>(u(),c("option",{key:o.id,value:o.id},p(o.name),9,Q))),128))],512),[[V,t.categoryId]])]),e("div",null,[s[18]||(s[18]=e("label",{class:"form-label"},"Description",-1)),n(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=o=>t.description=o),class:"form-input",rows:"3",placeholder:"Product description"},null,512),[[d,t.description]])]),e("div",X,[e("div",null,[s[19]||(s[19]=e("label",{class:"form-label"},"Unit *",-1)),n(e("input",{"onUpdate:modelValue":s[4]||(s[4]=o=>t.unit=o),type:"text",class:"form-input",placeholder:"e.g. piece, kg, liter",required:""},null,512),[[d,t.unit]])]),e("div",null,[s[20]||(s[20]=e("label",{class:"form-label"},"Unit Price *",-1)),n(e("input",{"onUpdate:modelValue":s[5]||(s[5]=o=>t.unitPrice=o),type:"number",class:"form-input",placeholder:"0",min:"0",step:"0.01",required:""},null,512),[[d,t.unitPrice,void 0,{number:!0}]])]),e("div",null,[s[21]||(s[21]=e("label",{class:"form-label"},"Cost Price",-1)),n(e("input",{"onUpdate:modelValue":s[6]||(s[6]=o=>t.costPrice=o),type:"number",class:"form-input",placeholder:"0",min:"0",step:"0.01"},null,512),[[d,t.costPrice,void 0,{number:!0}]])])]),e("div",Y,[e("div",null,[s[22]||(s[22]=e("label",{class:"form-label"},"Min Stock Level",-1)),n(e("input",{"onUpdate:modelValue":s[7]||(s[7]=o=>t.minStockLevel=o),type:"number",class:"form-input",placeholder:"0",min:"0"},null,512),[[d,t.minStockLevel,void 0,{number:!0}]])]),e("div",null,[s[23]||(s[23]=e("label",{class:"form-label"},"Max Stock Level",-1)),n(e("input",{"onUpdate:modelValue":s[8]||(s[8]=o=>t.maxStockLevel=o),type:"number",class:"form-input",placeholder:"0",min:"0"},null,512),[[d,t.maxStockLevel,void 0,{number:!0}]])])]),e("div",Z,[e("div",null,[s[24]||(s[24]=e("label",{class:"form-label"},"Weight (kg)",-1)),n(e("input",{"onUpdate:modelValue":s[9]||(s[9]=o=>t.weight=o),type:"number",class:"form-input",placeholder:"0",min:"0",step:"0.001"},null,512),[[d,t.weight,void 0,{number:!0}]])]),e("div",null,[s[25]||(s[25]=e("label",{class:"form-label"},"Dimensions",-1)),n(e("input",{"onUpdate:modelValue":s[10]||(s[10]=o=>t.dimensions=o),type:"text",class:"form-input",placeholder:"e.g. 10x5x2 cm"},null,512),[[d,t.dimensions]])])]),e("div",_,[e("div",null,[s[26]||(s[26]=e("label",{class:"form-label"},"Barcode",-1)),n(e("input",{"onUpdate:modelValue":s[11]||(s[11]=o=>t.barcode=o),type:"text",class:"form-input",placeholder:"Barcode"},null,512),[[d,t.barcode]])]),e("div",null,[s[27]||(s[27]=e("label",{class:"form-label"},"SKU",-1)),n(e("input",{"onUpdate:modelValue":s[12]||(s[12]=o=>t.sku=o),type:"text",class:"form-input",placeholder:"SKU"},null,512),[[d,t.sku]])])]),e("div",ee,[e("button",{type:"button",onClick:k,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"}," Cancel "),e("button",{type:"submit",disabled:g.value,class:"btn-primary"},p(g.value?"Saving...":(y=S.product)!=null&&y.id?"Update Product":"Add Product"),9,te)])],32)])])):I("",!0)}}},oe={class:"sm:flex sm:items-center mb-6"},le={class:"mt-4 sm:mt-0 sm:ml-16 sm:flex-none"},ie={class:"bg-white p-4 rounded-lg shadow mb-6"},ae={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},re=["value"],ne={class:"card"},de={class:"card-body overflow-x-auto"},ue={class:"min-w-full divide-y divide-gray-200"},ce={class:"bg-white divide-y divide-gray-200"},pe={class:"px-6 py-4"},me={class:"text-sm font-medium text-gray-900"},ve={class:"text-sm text-gray-500"},ge={class:"px-6 py-4 text-sm text-gray-900"},xe={class:"px-6 py-4 text-sm text-gray-900"},ye={class:"px-6 py-4 text-sm text-gray-900"},fe={class:"px-6 py-4"},be={class:"px-6 py-4 text-sm font-medium space-x-2"},ke=["onClick"],we=["onClick"],he={__name:"Products",setup(S){const U=R(),f=v([]),h=v([]),g=v(!1),m=v(!1),b=v(null),t=v({search:"",categoryId:"",isActive:""}),P=T(()=>{var a;return["admin","warehouse_manager"].includes((a=U.user)==null?void 0:a.role)}),A=a=>new Intl.NumberFormat("fa-IR",{style:"currency",currency:"IRR"}).format(a);let k;const C=()=>{clearTimeout(k),k=setTimeout(()=>{i()},300)},i=async()=>{g.value=!0;try{const a=new URLSearchParams;t.value.search&&a.append("search",t.value.search),t.value.categoryId&&a.append("categoryId",t.value.categoryId),t.value.isActive&&a.append("isActive",t.value.isActive);const l=await w.get(`/products?${a}`);f.value=l.data.data.products}catch(a){console.error("Failed to load products:",a)}finally{g.value=!1}},s=async()=>{try{const a=await w.get("/categories");h.value=a.data.data.categories}catch(a){console.error("Failed to load categories:",a)}},x=a=>{b.value=a,m.value=!0},y=()=>{m.value=!1,b.value=null},o=()=>{i()},L=async a=>{if(confirm("Are you sure you want to delete this product?"))try{await w.delete(`/products/${a}`),i()}catch(l){console.error("Failed to delete product:",l),alert("Failed to delete product. Please try again.")}};return B([()=>t.value.categoryId,()=>t.value.isActive],()=>{i()}),D(()=>{i(),s()}),(a,l)=>(u(),c("div",null,[e("div",oe,[l[4]||(l[4]=e("div",{class:"sm:flex-auto"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"Products"),e("p",{class:"text-gray-600"},"Manage your product catalog")],-1)),e("div",le,[P.value?(u(),c("button",{key:0,type:"button",class:"btn-primary",onClick:l[0]||(l[0]=r=>m.value=!0)}," Add Product ")):I("",!0)])]),e("div",ie,[e("div",ae,[e("div",null,[n(e("input",{"onUpdate:modelValue":l[1]||(l[1]=r=>t.value.search=r),type:"text",placeholder:"Search products...",class:"form-input",onInput:C},null,544),[[d,t.value.search]])]),e("div",null,[n(e("select",{"onUpdate:modelValue":l[2]||(l[2]=r=>t.value.categoryId=r),class:"form-input"},[l[5]||(l[5]=e("option",{value:""},"All Categories",-1)),(u(!0),c($,null,F(h.value,r=>(u(),c("option",{key:r.id,value:r.id},p(r.name),9,re))),128))],512),[[V,t.value.categoryId]])]),e("div",null,[n(e("select",{"onUpdate:modelValue":l[3]||(l[3]=r=>t.value.isActive=r),class:"form-input"},[...l[6]||(l[6]=[e("option",{value:""},"All Status",-1),e("option",{value:"true"},"Active",-1),e("option",{value:"false"},"Inactive",-1)])],512),[[V,t.value.isActive]])])])]),e("div",ne,[e("div",de,[e("table",ue,[l[8]||(l[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Product"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Category"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Price"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Unit"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",ce,[(u(!0),c($,null,F(f.value,r=>{var M;return u(),c("tr",{key:r.id},[e("td",pe,[e("div",null,[e("div",me,p(r.name),1),e("div",ve,p(r.code),1)])]),e("td",ge,p((M=r.Category)==null?void 0:M.name),1),e("td",xe,p(A(r.unitPrice)),1),e("td",ye,p(r.unit),1),e("td",fe,[e("span",{class:E(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",r.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},p(r.isActive?"Active":"Inactive"),3)]),e("td",be,[l[7]||(l[7]=e("button",{class:"text-indigo-600 hover:text-indigo-900"},"View",-1)),P.value?(u(),c("button",{key:0,onClick:N=>x(r),class:"text-indigo-600 hover:text-indigo-900"},"Edit",8,ke)):I("",!0),P.value?(u(),c("button",{key:1,onClick:N=>L(r.id),class:"text-red-600 hover:text-red-900"},"Delete",8,we)):I("",!0)])])}),128))])])])]),z(se,{"is-open":m.value,product:b.value,onClose:y,onSaved:o},null,8,["is-open","product"])]))}};export{he as default};
